var BASE,CONFIG,EventEmitter,MessageFormat,Server,USER_CONFIG_PATH,Wolves,color,fs,irc,os,sty,utils,yml,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},__slice=[].slice,__indexOf=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};fs=require("fs"),os=require("os"),yml=require("js-yaml"),EventEmitter=require("events").EventEmitter,MessageFormat=require("messageformat"),require.extensions[".yml"]=function(a,b){return a.exports=yml.safeLoad(fs.readFileSync(b))},USER_CONFIG_PATH=""+process.env.HOME+"/.wolves",BASE=fs.existsSync(USER_CONFIG_PATH)?USER_CONFIG_PATH:"../config",CONFIG=require(BASE+"/config.yml"),CONFIG.IRC=require(BASE+"/irc.yml"),Wolves={Village:{}},Number.prototype.plural=function(a,b){return null==b&&(b=""),(1===this.valueOf()?a:b).replace(/%d/g,this.valueOf())},utils={duration:function(a,b){var c,d,e,f;return null==a&&(a="1s"),null==b&&(b=0),f={s:1,m:60,h:3600},d=RegExp(""+Object.keys(f)),c="(\\d+)(["+d+"])",e=a.match(RegExp(""+c,"gi")),e.forEach(function(a){var d,e,g;return g=a.match(RegExp(""+c)).slice(1),e=g[0],d=g[1],b+=f[d]*e}),1e3*b},time:function(a){var b,c,d,e,f;return f=a.match(/(\d+)([\.\:](\d+))?(am|pm)/),e=f[0],c=f[1],e=f[2],d=f[3],b=f[4],"pm"===b&&(c=12+ +c),d||(d=0),[+c,+d]},wait:function(a,b,c){return setTimeout(b.bind(c),a)},repeat:function(a,b,c){return setInterval(b.bind(c),a)},cancel:function(a){return clearTimeout(a)},stop:function(a){return clearInterval(a)},translations:function(a){var b,c;return b=require("./locales/"+a+"/i18n.json"),c=new MessageFormat(a,this.localePlurals[a]),function(a,d){var e,f;return null==d&&(d={}),(e=c.compile((null!=(f=b[a])?f.value:void 0)||a))(d)}},localePlurals:{en:function(a){return 1===a?"one":"other"},tr:function(a){return 1===a?"one":"other"}}},irc=require("irc"),sty=require("sty"),color=require("irc-colors"),Wolves.Bot=function(a){function b(){this.prepClient(),this.prepEvents(),"function"==typeof this.loadExtensions&&this.loadExtensions(),this.emit("self:start",{client:this.client})}return __extends(b,a),b.prototype.settings=CONFIG.IRC,b.prototype.toString=function(){return"Wolves node/"+process.versions.node},b.prototype.connect=function(){this.client.connect()},b.prototype.prepClient=function(){return this.client=new irc.Client(this.settings.connection.host,this.settings.auth.username,{userName:this.settings.auth.username,realName:this.settings.auth.realname,password:""+this.settings.auth.password,port:this.settings.connection.port,channels:[this.settings.channel],autoConnect:!1,autoRejoin:!0,debug:this.settings.connection.debug})},b.prototype.prepEvents=function(){return this.client.on("error",function(a){return this.emit("client:error",a)}),this.client.on("registered",function(a){return function(b){return a.send("NICK",a.settings.nickname),a.emit("self:connected",{server:b.server})}}(this)),this.client.on("message",function(a){return function(b,c,d){return c!==a.settings.nick?a.emit("user:talk",{nick:b,channel:c,text:d,client:a.client,reply:function(b){return a.say(b,c)}}):void 0}}(this)),this.client.on("pm",function(a){return function(b,c){return a.emit("user:private",{nick:b,text:c,client:a.client,reply:function(c){return a.say(c,b)}})}}(this)),this.client.on("join",function(a){return function(b,c,d){return c===a.settings.nickname?a.emit("self:join",{channel:b,nick:c,text:d,client:a.client}):a.emit("user:join",{channel:b,nick:c,text:d,client:a.client,reply:function(c){return a.say(c,b)}})}}(this))},b.prototype.debug=function(a,b){return this.settings.botDebug?console.log("["+sty.bold("debug")+"]("+sty.red(sty.bold(a))+") "+sty.bold(b)):void 0},b.prototype.emit=function(){var a,c;return a=arguments[0],c=2<=arguments.length?__slice.call(arguments,1):[],b.__super__.emit.apply(this,[a].concat(__slice.call(c))),"*"!==a?this.emit.apply(this,["*",a].concat(__slice.call(c))):void 0},b.prototype.on=function(a,c){var d,e,f,g;if("string"==typeof a)return b.__super__.on.call(this,a,c);if(null!=a.event&&null!=a.trigger)return this.on(a.event,a.trigger);for(g=[],e=0,f=a.length;f>e;e++)d=a[e],g.push(this.on(d));return g},b.prototype.say=function(a,b){var c,d,e,f;if(null!=b)return this.client.say(b,a),this.emit("self:talk",{channel:b,text:a,client:this.client});for(e=this.channels,f=[],c=0,d=e.length;d>c;c++)b=e[c],this.emit("self:talk",{channel:b,text:a,client:this.client}),f.push(this.client.say(b,a));return f},b.prototype.leave=function(a,b){return __indexOf.call(this.channels,channels)>=0?(this.client.part(a,b),this.channels.pop(a)):void 0},b.prototype.join=function(a,b){return this.client.join(a,b),this.chanels.push(a)},b.prototype.send=function(){var a;return(a=this.client).send.apply(a,arguments)},b.prototype.chanserv=function(a){return this.say(a,"chanserv")},b}(EventEmitter),Wolves.Bot.prototype.hear=function(a,b){return this.on("user:talk",function(c){return c.text.match(a)?b(c):void 0})},Wolves.Bot.prototype.listenCommands=function(a){var b;return null==a&&(a=this.settings.commander),b=RegExp("^"+a+"(\\w+)"),this.hear(b,function(a){return function(c){var d,e,f;return f=c.text.match(b),e=f[0],d=f[1],a.emit("command:"+d,c)}}(this))},Wolves.Bot.prototype.loadExtensions=function(){return this.settings.botDebug&&this.on("*",function(a,b){return this.debug(a(b))}),this.on("self:start",function(){var a;return a=this.toString(),console.log("["+sty.bold(sty.green(a))+"] IRC Client "+sty.bold(sty.cyan("loaded"))+", ready to connect.")}),this.on("self:connected",function(a){return console.log("Connected to the server "+sty.green(sty.bold(a.server)))}),this.on("self:join",function(a){return console.log("Joined "+sty.yellow(a.channel))}),this.on("self:talk",function(a){return console.log("["+sty.bold(sty.red(a.channel))+"] "+sty.green(a.text))}),this.on("user:private",function(a){return console.log("["+sty.bold(sty.red("private"))+"] "+sty.green(a.nick)+": "+a.text)})},Server=function(){function a(a,b){this.Wolves=a,console.log(""+sty.red(sty.bold("Wolves"))+": "+sty.yellow("IRC Based Werewolf Game")),CONFIG.IRC.connection.debug=b.debug||b.d}return a.prototype.run=function(a,b,c){return null!=this[a]?(console.log("=> "+sty.blue(a)),this[a](b,c)):void 0},a.prototype.start=function(){var a,b,c;return b=[],c=new this.Wolves.World,a=new Wolves.Bot,a.listenCommands(),a.on("self:join",function(b){return console.log("Joined "+sty.bold(b.channel)+" with name "+sty.bold(b.nick)),a.chanserv("OP "+b.channel+" "+b.nick),a.say(color.bold.rainbow("Wolves Bot Initialized"),b.channel)}),a.on("command:join",function(a){return b.push(a.nick),a.reply(1===b.length?translate('{name} yeni bir oyun isteği gönderdi. Oyuncuları davet etmek için "!ping" komutunu kullanın',{name:a.nick}):translate("{name} oyuna katıldı. Şu an oyunda {count} kişi var.",{name:a.nick,count:b.length}))}),a.connect()},a}(),module.exports=function(a,b){var c,d,e,f;return null==a&&(a="default"),b.locale&&(CONFIG.locale["default"]=b.locale),e=utils.translations(CONFIG.locale["default"]),f=b._,a=f[0],d=f[1],c=new Server(this,b),c.run(a,d,b)};