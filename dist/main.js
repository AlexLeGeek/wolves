var CONFIG,Detective,EventEmitter,Human,Seer,Stranger,Villager,Wolves,duration,fs,os,repeat,stop,translate,translations,wait,_,_ref,_ref1,_ref2,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},__indexOf=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};require("better-require")("json yaml"),fs=require("fs"),os=require("os"),EventEmitter=require("events").EventEmitter,_=require("underscore"),_.templateSettings={interpolate:/\{\{(.+?)\}\}/g},CONFIG=require("../config/config.yml"),CONFIG.IRC=require("../config/irc.yml"),Number.prototype.plural=function(a,b){return null==b&&(b=""),(1===this.valueOf()?a:b).replace(/%d/g,this.valueOf())},Wolves={Village:{},Utils:{}},Wolves.Utils={duration:function(a,b){var c,d,e,f;return null==a&&(a="1s"),null==b&&(b=0),f={s:1,m:60,h:3600},d=RegExp(""+Object.keys(f)),c="(\\d+)(["+d+"])",e=a.match(RegExp(""+c,"gi")),e.forEach(function(a){var d,e,g;return g=a.match(RegExp(""+c)).slice(1),e=g[0],d=g[1],b+=f[d]*e}),1e3*b},time:function(a){var b,c,d,e;return e=a.match(/\d+([\.:]\d+)?(am|pm)/),_=e[0],c=e[1],_=e[2],d=e[3],b=e[4],"pm"===b&&(c=12+ +c),d||(d=0),[c,+d]},wait:function(a,b,c){return setTimeout(b.bind(c),a)},repeat:function(a,b,c){return setInterval(b.bind(c),a)},cancel:function(a){return clearTimeout(a)},stop:function(a){return clearInterval(a)},translations:function(a){var b;return b=require(a),function(a,c){var d;return null==c&&(c={}),_.template((null!=(d=b[a])?d[1]:void 0)||a,c)}}},translations=Wolves.Utils.translations,translate=translations("../dist/i18n/"+CONFIG.locale["default"]+".json"),_ref=Wolves.Utils,duration=_ref.duration,wait=_ref.wait,repeat=_ref.repeat,stop=_ref.stop,Wolves.World=function(a){function b(){var a,b,c,d;d=this.day.night,a=d[0],b=d[1],this.currentTime=new Date(0,0,0,a,b,0),c=repeat(this.minute,1e3,this),wait(this.day.length,function(){return function(){return stop(c)}}(this))}return __extends(b,a),b.prototype.day={length:duration("10m"),morning:time("6am"),evening:time("7pm"),night:time("1am")},b.prototype.event=function(a,b){return this.emit("fact",b)},b.prototype.sun=function(a){return this.event("sun",a)},b.prototype.day=function(){return this.sun("rise")},b.prototype.night=function(){return this.sun("set")},b.prototype.minute=function(){return this.currentTime.setTime(this.currentTime.getTime()+6e4)},b}(EventEmitter),Wolves.Human=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.username="",b.prototype.requests=function(){return this.emit.apply(this,arguments)},b.prototype.listens=function(){return this.on.apply(this,arguments)},b}(EventEmitter),Human=Wolves.Human,Wolves.Stranger=function(a){function b(){}return __extends(b,a),b.prototype.username="",b.prototype.isAdmin=!1,b.prototype.isOwner=!1,b.prototype.isActive=!1,b.prototype.ableTo=function(a,b){var c;return c=b.at,__indexOf.call(this.can(c),a)>=0},b.prototype.join=function(){return this.requests("join")},b.prototype.start=function(){return this.requests("start")},b}(Human),Stranger=Wolves.Stranger,Wolves.Village.Villager=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.can=function(a,b){return null==b&&(b=[]),b.concat(function(){switch(!0){case"day"===a:return["vote","retract","goat"]}}())},b.prototype.seenAs=function(){return"villager"},b.prototype.coin=function(){return Math.random()>.5?"heads":"tails"},b.prototype.goats=function(a){return this.requests("goat",{to:a})},b.prototype.votes=function(a){return this.requests("vote",{to:a})},b.prototype.retracts=function(a){return this.requests("retract",{from:a})},b.prototype.reports=function(){return this.requests("votes")},b.prototype.role=function(){return this.requests("role")},b.prototype.leaves=function(){return this.requests("leave")},b}(Stranger),Villager=Wolves.Village.Villager,translate=Wolves.Utils.translate,Wolves.Village.Angel=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.population=function(a){switch(!0){case __indexOf.call([17,18,19,20],a)>=0:return 1}},b.prototype.can=function(a){return b.__super__.can.call(this,a,"night"===a?["protect"]:void 0)},b.prototype.protect=function(a){return this.announce("protect",a)},b.prototype.messages=function(a){switch(a){case"dead by wolf":return translate("{{name}}, the angel is killed by the wolf",{name:this.username});case"dead by people":return translate("{{name}}, the angel is killed by the people",{name:this.username})}},b}(Villager),Villager=Wolves.Village.Villager,Wolves.Village.Crow=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.population=function(a){switch(!0){case __indexOf.call([12,13,14,15,16,17,18,19,20],a)>=0:return 1}},b.prototype.can=function(a){return b.__super__.can.call(this,a,"night"===a?["kill","observe"]:void 0)},b.prototype.kill=function(a){return this.announce("kill",a)},b.prototype.observe=function(a){return this.announce("observe",a)},b}(Villager),_ref1=Wolves.Village,Seer=_ref1.Seer,Detective=_ref1.Detective,Villager=_ref1.Villager,Wolves.Village.Cursed=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.population=function(a){switch(!0){case __indexOf.call([4,5,6,7,8,9,10,11,12,13,14,15,16,17],a)>=0:return 1;case __indexOf.call([18,19,20],a)>=0:return 2}},b.prototype.seenAs=function(a){switch(!0){case a instanceof Seer:return"wolf";case a instanceof Detective:return"cursed";default:return b.__super__.seenAs.apply(this,arguments)}},b}(Villager),Villager=Wolves.Village.Villager,Wolves.Village.Detective=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.population=function(a){switch(!0){case __indexOf.call([12,13,14,15,16,17,18,19,20],a)>=0:return 1}},b.prototype.can=function(a){return b.__super__.can.call(this,a,"day"===a?["id"]:void 0)},b.prototype.id=function(a){return this.announce("id",a)},b}(Villager),Villager=Wolves.Village.Villager,Wolves.Village.Drunk=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.population=function(a){switch(!0){case __indexOf.call([8,9,10,11,12,13,14,15,16,17,18,19,20],a)>=0:return 1}},b}(Villager),Villager=Wolves.Village.Villager,Wolves.Village.Gunner=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.population=function(a){switch(!0){case __indexOf.call([10,11,12,13,14,15,16,17,18,19,20],a)>=0:return 1}},b.prototype.can=function(a){return b.__super__.can.call(this,a,"night"===a?["shoot"]:void 0)},b.prototype.shoot=function(){},b}(Villager),Villager=Wolves.Village.Villager,Wolves.Village.Harlot=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.population=function(a){switch(!0){case __indexOf.call([8,9,10,11,12,13,14,15,16,17,18,19,20],a)>=0:return 1}},b.prototype.can=function(a){return b.__super__.can.call(this,a,"night"===a?["visit"]:void 0)},b.prototype.visit=function(){},b}(Villager),Villager=Wolves.Village.Villager,Wolves.Village.Seer=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.population=function(a){switch(!0){case __indexOf.call([4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],a)>=0:return 1}},b.prototype.can=function(a){return b.__super__.can.call(this,a,"night"===a?["see"]:void 0)},b.prototype.see=function(){},b}(Villager),_ref2=Wolves.Village,Seer=_ref2.Seer,Detective=_ref2.Detective,Villager=_ref2.Villager,Wolves.Village.Traitor=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.population=function(a){switch(!0){case __indexOf.call([8,9,10,11,12,13,14,15,16,17,18,19,20],a)>=0:return 1}},b.prototype.seenAs=function(a){switch(!0){case a instanceof Seer:return"villager";case a instanceof Detective:return"traitor"}},b}(Villager),Villager=Wolves.Village.Villager,Wolves.Village.Wolf=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.population=function(a){switch(!0){case __indexOf.call([4,5,6,7,8,9,10],a)>=0:return 1;case __indexOf.call([11,12,13],a)>=0:return 2;case __indexOf.call([14,15,16,17,18,19],a)>=0:return 3;case 20===a:return 4}},b.prototype.can=function(a){return b.__super__.can.call(this,a,"night"===a?["kill"]:void 0)},b.prototype.seenAs=function(){return"wolf"},b.prototype.kill=function(){},b}(Villager),Wolves.Village.ExampleRole=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.can=function(a){return b.__super__.can.call(this,a,"night"===a?["doSomething"]:void 0)},b.prototype.doSomething=function(){},b}(Villager),Villager=Wolves.Village.Villager,Wolves.Square=function(){function a(){}return a.prototype.villagers=[],a.prototype.addVillager=function(a){return this.villagers.push(a)},a.prototype.createVillagers=function(a){return null==a&&(a=[]),this.villagers.map(function(){return new Villager(player)})},a.prototype.generateVillagers=function(){return console.log(Village)},a}(),module.exports=Wolves;